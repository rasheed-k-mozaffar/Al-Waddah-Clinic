@page "/patients/all"
@attribute [Authorize(Roles = "Admin")]
@inject ILanguageContainerService Lang

<style>
    .dialog-background-blur {
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
    }
</style>

<MudContainer Class="mt-5">
    <MudItem Class="d-flex justify-space-between mb-3 align-center">
        <MudItem xs="12" md="12" lg="12">
            <MudTextField Variant="Variant.Outlined" Margin="Margin.Dense" Placeholder="@Lang.Keys["Patients:SearchText"]" @bind-Value="_searchText" Immediate="true" Adornment="Adornment.Start" AdornmentColor="Color.Primary" AdornmentIcon="@Icons.Material.Filled.Search" T="string" />
        </MudItem>
    </MudItem>
    <MudItem Class="d-flex justify-space-between mb-5">
        <MudItem>
            <MudText Typo="Typo.h4" Color="Color.Dark"><b>@Lang.Keys["Patients:Title"]</b></MudText>
        </MudItem>

        <MudItem>
            <MudButton Variant="Variant.Filled" Color="Color.Dark" OnClick="@GoToAddPatient" StartIcon="@Icons.Material.Filled.Add">@Lang.Keys["Patients:AddBtn"]</MudButton>
        </MudItem>
    </MudItem>
    @if (_isBusy)
    {
        <MudGrid Class="d-flex justify-center" Style="height: 25vh; align-items: center;">
            <MudItem>
                <Loader />
            </MudItem>
        </MudGrid>
    }
    else
    {

        <MudItem Class="d-flex justify-center align-center">
            @{
                if (patients is null || !patients.Any())
                {
                    <MudItem xs="12" md="12" lg="12" Class="d-flex justify-center align-center flex-column" Style="height: 500px;">
                        <MudItem>
                            <MudText Typo="Typo.h6" Color="Color.Primary"><b>@Lang.Keys["Patients:NoPatients"]</b></MudText>
                        </MudItem>
                        <MudItem>
                            <img width="350" src="images/no-patients.png" alt="You have currently have no patients" />
                        </MudItem>
                    </MudItem>
                }
                else
                {
                    <MudGrid Justify="Justify.FlexStart" Spacing="1">
                        @if (string.IsNullOrEmpty(_searchText))
                        {
                            @foreach (var patient in patients.OrderBy(p => p.FullName))
                            {
                                <MudItem xs="12" md="6" lg="4">
                                    <PatientSummaryCard Patient="patient" OnPatientRemoval="HandlePatientRemoval" />
                                </MudItem>
                            }
                        }
                        else
                        {
                            @if (patients.Where(p => p.FullName.ToLower().Contains(_searchText.ToLower())).Count() > 0)
                            {
                                @foreach (var patient in patients.OrderBy(p => p.FullName).Where(p => p.FullName.ToLower().Contains(_searchText.ToLower())))
                                {

                                    <MudItem xs="12" md="6" lg="4">
                                        <PatientSummaryCard Patient="patient" OnPatientRemoval="HandlePatientRemoval" />
                                    </MudItem>
                                }
                            }
                            else
                            {
                                <MudItem xs="12" md="12" lg="12" Class="d-flex justify-center align-center flex-column" Style="height: 500px;">
                                    <MudItem>
                                        <MudText Typo="Typo.h6" Color="Color.Primary"><b>@Lang.Keys["Patients:NoResults"]</b></MudText>
                                    </MudItem>
                                    <MudItem>
                                        <img width="350" src="images/no-results.png" alt="Nothing was found" />
                                    </MudItem>
                                </MudItem>
                            }
                        }
                    </MudGrid>
                }
            }
        </MudItem>
    }
</MudContainer>


@code{
    protected override void OnInitialized()
    {
        Lang.InitLocalizedComponent(this);
        base.OnInitialized();
    }
}
